<html>
<head>
<title>Genshin Roulette</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js" type="text/javascript"></script>
<script type="text/javascript">

var Character = function(name, rarity, element, height, sex, weapon, region, release, talentbook) {
	this.name = name.replace(/\|.*/, "");
	this.displayname = name.replace(/.*\|/, "");
	this.rarity = rarity;
	this.element = element;
	this.height = height;
	this.sex = sex;
	this.weapon = weapon;
	this.region = region;
	this.release = release;
	this.talentbook = talentbook;
	this.bossdrop = "";
	this.specialty = "";
	this.weekly = "";
	this.banners = [];
	this.outfits = [];
}

var qualities = ["name", "height", "element", "sex", "rarity", "height", "weapon", "region", "release", "talentbook", "specialty", "bossdrop", "weekly"];

var characters = [
	 new Character("Aether",  "5", "Geo", "Medium", "Male", "Sword", "Outlander", "v1.0", "Freedom"), 
	 new Character("Aether",  "5", "Electro", "Medium", "Male", "Sword", "Outlander", "v1.0", "Light"), 
	 new Character("Albedo",  "5", "Geo", "Medium", "Male", "Sword", "Mondstadt", "v1.2", "Ballad"), 
	 new Character("Aloy",    "5a", "Cryo", "Medium", "Female", "Bow", "Outlander", "v2.1", "Freedom"), 
	 new Character("Amber",   "4", "Pyro", "Medium", "Female", "Bow", "Mondstadt", "v1.0", "Freedom"), 
	 new Character("Kamisato Ayaka|Ayaka",   "5", "Cryo", "Medium", "Female", "Sword", "Inazuma", "v2.0", "Elegance"), 
	 new Character("Barbara", "4", "Hydro", "Medium", "Female", "Catalyst", "Mondstadt", "v1.0", "Freedom"), 
	 new Character("Beidou",  "4", "Electro", "Tall", "Female", "Claymore", "Liyue", "v1.0", "Gold"), 
	 new Character("Bennett", "4", "Pyro", "Medium", "Male", "Sword", "Mondstadt", "v1.0", "Resistance"), 
	 new Character("Chongyun", "4", "Cryo", "Medium", "Male", "Claymore", "Liyue", "v1.0", "Diligence"), 
	 new Character("Diluc",    "5", "Pyro", "Tall", "Male", "Claymore", "Mondstadt", "v1.0", "Resistance"), 
	 new Character("Diona",    "4", "Cryo", "Small", "Female", "Bow", "Mondstadt", "v1.1", "Freedom"), 
	 new Character("Eula",    "5", "Cryo", "Tall", "Female", "Claymore", "Mondstadt", "v1.5", "Resistance"), 
	 new Character("Fischl",    "4", "Electro", "Medium", "Female", "Bow", "Mondstadt", "v1.0", "Ballad"), 
	 new Character("Ganyu",     "5", "Cryo", "Medium", "Female", "Bow", "Liyue", "v1.2", "Diligence"), 
	 new Character("Hu Tao",    "5", "Pyro", "Medium", "Female", "Polearm", "Liyue", "v1.3", "Diligence"), 
	 new Character("Jean",      "5", "Anemo", "Tall", "Female", "Sword", "Mondstadt", "v1.0", "Resistance"), 
	 new Character("Kaeya",     "4", "Cryo", "Tall", "Male", "Sword", "Mondstadt", "v1.0", "Ballad"), 
	 new Character("Kaedehara Kazuha|Kazuha",    "5", "Anemo", "Medium", "Male", "Sword", "Inazuma", "v1.6", "Diligence"), 
	 new Character("Keqing",    "5", "Electro", "Medium", "Female", "Sword", "Liyue", "v1.0", "Prosperity"), 
	 new Character("Klee",      "5", "Pyro", "Small", "Female", "Catalyst", "Mondstadt", "v1.0", "Freedom"), 
	 new Character("Sangonomiya Kokomi|Kokomi",    "5", "Hydro", "Medium", "Female", "Catalyst", "Inazuma", "v2.1", "Transience"), 
	 new Character("Kujou Sara", "4", "Electro", "Tall", "Female", "Bow", "Inazuma", "v2.1", "Elegance"), 
	 new Character("Lisa",       "4", "Electro", "Tall", "Female", "Catalyst", "Mondstadt", "v1.0", "Ballad"), 
	 new Character("Lumine",     "5", "Anemo", "Medium", "Female", "Sword", "Outlander", "v1.0", "Freedom"), 
	 new Character("Lumine",     "5", "Dendro", "Medium", "Female", "Sword", "Outlander", "v1.0", "Praxis"), 
	 new Character("Mona",       "5", "Hydro", "Medium", "Female", "Catalyst", "Mondstadt", "v1.0", "Resistance"), 
	 new Character("Ningguang",  "4", "Geo", "Tall", "Female", "Catalyst", "Liyue", "v1.0", "Prosperity"), 
	 new Character("Noelle",     "4", "Geo", "Medium", "Female", "Claymore", "Mondstadt", "v1.0", "Resistance"), 
	 new Character("Qiqi",       "5", "Cryo", "Small", "Female", "Sword", "Liyue", "v1.0", "Prosperity"), 
	 new Character("Raiden Shogun|Raiden", "5", "Electro", "Tall", "Female", "Polearm", "Inazuma", "v2.1", "Light"), 
	 new Character("Razor",      "4", "Electro", "Medium", "Male", "Claymore", "Mondstadt", "v1.0", "Resistance"), 
	 new Character("Rosaria",    "4", "Cryo", "Tall", "Female", "Polearm", "Mondstadt", "v1.4", "Ballad"), 
	 new Character("Sayu",       "4", "Anemo", "Small", "Female", "Claymore", "Inazuma", "v2.0", "Light"), 
	 new Character("Sucrose",    "4", "Anemo", "Medium", "Female", "Catalyst", "Mondstadt", "v1.0", "Freedom"), 
	 new Character("Tartaglia",  "5", "Hydro", "Tall", "Male", "Bow", "Snezhnaya", "v1.1", "Freedom"), 
	 new Character("Thoma",      "4", "Pyro", "Tall", "Male", "Polearm", "Inazuma", "v2.2", "Transience"), 
	 new Character("Venti",      "5", "Anemo", "Medium", "Male", "Bow", "Mondstadt", "v1.0", "Ballad"), 
	 new Character("Xiangling",  "4", "Pyro", "Medium", "Female", "Polearm", "Liyue", "v1.0", "Diligence"), 
	 new Character("Xiao",       "5", "Anemo", "Medium", "Male", "Polearm", "Liyue", "v1.3", "Prosperity"), 
	 new Character("Xingqiu",    "4", "Hydro", "Medium", "Male", "Sword", "Liyue", "v1.0", "Gold"), 
	 new Character("Xinyan",     "4", "Pyro", "Medium", "Female", "Claymore", "Liyue", "v1.1", "Gold"), 
	 new Character("Yanfei",     "4", "Pyro", "Medium", "Female", "Catalyst", "Liyue", "v1.5", "Gold"), 
	 new Character("Yoimiya",    "5", "Pyro", "Medium", "Female", "Bow", "Inazuma", "v2.0", "Transience"), 
	 new Character("Zhongli",    "5", "Geo", "Tall", "Male", "Polearm", "Liyue", "v1.1", "Gold"),
	 new Character("Arataki Itto|Itto",    "5", "Geo", "Tall", "Male", "Claymore", "Inazuma", "v2.3", "Elegance"),
	 new Character("Gorou",      "4", "Geo", "Medium", "Male", "Bow", "Inazuma", "v2.3", "Light"),
	 new Character("Shenhe",     "5", "Cryo", "Tall", "Female", "Polearm", "Liyue", "v2.4", "Prosperity"),
	 new Character("Yun Jin",    "4", "Geo", "Medium", "Female", "Polearm", "Liyue", "v2.4", "Diligence"),
	 new Character("Yae Miko",       "5", "Electro", "Tall", "Female", "Catalyst", "Inazuma", "v2.5", "Light"), 
	 new Character("Kamisato Ayato|Ayato",       "5", "Hydro", "Tall", "Male", "Sword", "Inazuma", "v2.6", "Elegance"), 
	 new Character("Yelan",       "5", "Hydro", "Tall", "Female", "Bow", "Liyue", "v2.7", "Prosperity"), 
	 new Character("Kuki Shinobu|Shinobu","4", "Electro", "Medium", "Female", "Sword", "Inazuma", "v2.7", "Elegance"), 
	 new Character("Shikanoin Heizou|Heizou","4", "Anemo", "Medium", "Male", "Catalyst", "Inazuma", "v2.8", "Transience"), 
	 new Character("Tighnari","5", "Dendro", "Medium", "Male", "Bow", "Sumeru", "v3.0", "Admonition"), 
	 new Character("Collei","4", "Dendro", "Medium", "Female", "Bow", "Sumeru", "v3.0", "Praxis"), 
	 new Character("Dori","4", "Electro", "Small", "Female", "Claymore", "Sumeru", "v3.0", "Ingenuity"), 
	 new Character("Nilou","5", "Hydro", "Medium", "Female", "Sword", "Sumeru", "v3.1", "Praxis"), 
	 new Character("Cyno","5", "Electro", "Medium", "Male", "Polearm", "Sumeru", "v3.1", "Admonition"), 
	 new Character("Candace","4", "Hydro", "Tall", "Female", "Polearm", "Sumeru", "v3.1", "Admonition"), 
	 new Character("Nahida","5", "Dendro", "Small", "Female", "Catalyst", "Sumeru", "v3.2", "Ingenuity"), 
	 new Character("Layla","4", "Cryo", "Medium", "Female", "Sword", "Sumeru", "v3.2", "Ingenuity"), 
	 new Character("Faruzan","4", "Anemo", "Medium", "Female", "Bow", "Sumeru", "v3.3", "Admonition"), 
	 new Character("Wanderer","5", "Anemo", "Medium", "Male", "Catalyst", "Sumeru", "v3.3", "Praxis"),
	 /*new Character("Dehya","4", "Pyro", "Medium", "Female", "Claymore", "Sumeru", "v3.1", ""), 
	 new Character("Al Haytham","5", "Dendro", "Tall", "Male", "Sword", "Sumeru", "v3.X", ""), 
	  
	 new Character("Nafs","5", "Electro", "Medium", "Male", "Catalyst", "Sumeru", "v3.X", ""), 
	 new Character("Ikhfa","5", "Electro", "Medium", "Male", "Catalyst", "Sumeru", "v3.X", ""), 
	 new Character("Djajeet","5", "Electro", "Medium", "Male", "Catalyst", "Sumeru", "v3.X", ""), 
	 new Character("Soutine","5", "Electro", "Medium", "Male", "Catalyst", "Sumeru", "v3.X", ""),*/
	 
	 
	 
];



var bossDrops = {
"Hurricane Seed": ["Jean", "Venti", "Sucrose"],
"Lightning Prism": ["Keqing", "Beidou", "Fischl", "Lisa", "Razor"],
"Basalt Pillar": ["Albedo", "Zhongli", "Ningguang", "Noelle"],
"Hoarfrost Core": ["Ganyu", "Qiqi", "Chongyun", "Diona", "Kaeya", "Rosaria"],
"Everflame Seed": ["Diluc", "Klee", "Amber", "Bennett", "Xiangling", "Xinyan"],
"Cleansing Heart": ["Mona", "Tartaglia", "Barbara", "Xingqiu"],
"Juvenile Jade": ["Hu Tao", "Xiao", "Yanfei"],
"Crystalline Bloom": ["Aloy", "Eula"],
"Marionette Core": ["Kaedehara Kazuha", "Sayu"],
"Perpetual Heart": ["Kamisato Ayaka", "Gorou"],
"Smoldering Pearl": ["Yoimiya", "Thoma"],
"Dew of Repudiation": ["Sangonomiya Kokomi", "Kamisato Ayato"],
"Storm Beads": ["Raiden Shogun", "Kujou Sara"],
"Riftborn Regalia": ["Arataki Itto", "Yun Jin"],
"Dragonheir's False Fin": ["Shenhe", "Yae Miko"],
"Runic Fang": ["Yelan", "Kuki Shinobu", "Shikanoin Heizou"],
"Majestic Hooked Beak": ["Collei", "Tighnari"],
"Thunderclap Fruitcore": ["Dori", "Cyno"],
"Quelled Creeper": ["Nahida"],
"Light Guiding Tetrahedron": ["Candace", "Faruzan"],
"Perpetual Caliber": ["Nilou", "Layla", "Wanderer"],
};

var weeklyBossDrops = {
"00|Dvalin's Plume": ["Bennett", "Diluc", "Jean"],  
"01|Dvalin's Claw": ["Lisa", "Noelle", "Razor", "Xiangling"],  
"02|Dvalin's Sigh": ["Lumine", "Aether", "Amber", "Beidou", "Chongyun"],  
"03|Tail of Boreas": ["Lumine", "Qiqi", "Venti", "Xingqiu"],  
"04|Ring of Boreas": ["Barbara", "Keqing", "Klee", "Mona"],  
"05|Spirit Locket of Boreas": ["Fischl", "Kaeya", "Ningguang", "Sucrose"],  
"06|Tusk of Monoceros Caeli": ["Albedo", "Xinyan", "Zhongli"],  
"07|Shard of a Foul Legacy": ["Diona", "Hu Tao", "Tartaglia"],  
"08|Shadow of the Warrior": ["Ganyu", "Rosaria", "Xiao"],  
"09|Dragon Lord's Crown": ["Eula", "Yoimiya"],  
"10|Bloodjade Branch": ["Kamisato Ayaka", "Yanfei", "Dori"],  
"11|Gilded Scale": ["Kaedehara Kazuha", "Sayu", "Yelan"],  
"12|Molten Moment": ["Aloy", "Gorou", "Raiden Shogun"],  
"13|Hellfire Butterfly": ["Sangonomiya Kokomi", "Shenhe", "Thoma"],  
"14|Ashen Heart": ["Arataki Itto", "Kujou Sara", "Yun Jin"],  
"15|Mudra of the Malefic General": ["Kamisato Ayato", "Cyno"],  
"16|Tears of the Calamitous God": ["Kuki Shinobu", "Collei", "Candace", "Nilou"],
"17|The Meaning of Aeons": ["Yae Miko", "Shikanoin Heizou", "Tighnari"],  
"18|Puppet Strings": ["Nahida", "Faruzan"],  
"19|Mirror of Mushin": ["Layla"],
"20|Daka's Bell": ["Wanderer"],  
};


var specialities = {
"0|Calla Lily": ["Diona", "Kaeya"],
"0|Wolfhook": ["Razor"],
"0|Valberry": ["Lisa", "Noelle", "Rosaria"],
"0|Cecilia": ["Albedo", "Venti"],
"0|Windwheel Aster": ["Aether", "Lumine", "Bennett", "Sucrose"],
"0|Philanemo Mushroom": ["Klee", "Mona", "Barbara"],
"0|Small Lamp Grass": ["Diluc", "Amber", "Fischl"],
"0|Dandelion Seed": ["Eula", "Jean"],
"1|Jueyun Chili": ["Xiangling"],
"1|Noctilucous Jade": ["Beidou", "Yanfei"],
"1|Silk Flower": ["Hu Tao", "Xingqiu"],
"1|Glaze Lily": ["Ningguang", "Yun Jin"],
"1|Qingxin": ["Ganyu", "Xiao", "Shenhe"],
"1|Starconch": ["Tartaglia", "Yelan"],
"1|Violetgrass": ["Qiqi", "Xinyan"],
"1|Cor Lapis": ["Keqing", "Zhongli", "Chongyun"],
"2|Onikabuto": ["Arataki Itto", "Shikanoin Heizou"],
"2|Sakura Bloom": ["Kamisato Ayaka", "Kamisato Ayato"],
"2|Crystal Marrow": ["Aloy", "Sayu"],
"2|Dendrobium": ["Kujou Sara"],
"2|Naku Weed": ["Yoimiya", "Kuki Shinobu"],
"2|Sea Ganoderma": ["Kaedehara Kazuha", "Yae Miko"],
"2|Sango Pearl": ["Sangonomiya Kokomi", "Gorou"],
"2|Amakumo Fruit": ["Raiden Shogun"],
"2|Fluorescent Fungus": ["Thoma"],
"3|Rukkhashava Mushrooms": ["Collei", "Wanderer"],
"3|Nilotpala Lotus": ["Tighnari", "Layla"],
"3|Kalpalata Lotus": ["Dori", "Nahida"],
"3|Henna Berry": ["Candace", "Faruzan"],
"3|Padisarah": ["Nilou"],
"3|Scarab": ["Cyno"],
};

var banners =  {
"Ballad in Goblets 2020-09-28" : ["Venti",  "Fischl",  "Xiangling",  "Barbara"], 
"Sparkling Steps 2020-10-20" : ["Klee",  "Sucrose",  "Noelle",  "Xingqiu"], 
"Farewell of Snezhnaya 2020-11-11" : ["Tartaglia",  "Diona",  "Ningguang",  "Beidou"], 
"Gentry of Hermitage 2020-12-01" : ["Zhongli",  "Xinyan",  "Chongyun",  "Razor"], 
"Secretum Secretorum 2020-12-23" : ["Albedo",  "Fischl",  "Sucrose",  "Bennett"], 
"Adrift in the Harbor 2021-01-12" : ["Ganyu",  "Noelle",  "Xingqiu",  "Xiangling"], 
"Invitation to Mundane Life 2021-02-03" : ["Xiao",  "Diona",  "Beidou",  "Xinyan"], 
"Dance of Lanterns 2021-02-17" : ["Keqing",  "Bennett",  "Ningguang",  "Barbara"], 
"Moment of Bloom 2021-03-02" : ["Hu Tao",  "Xingqiu",  "Xiangling",  "Chongyun"], 
"Ballad in Goblets 2021-03-17" : ["Venti",  "Noelle",  "Sucrose",  "Razor"], 
"Farewell of Snezhnaya 2021-04-06" : ["Tartaglia",  "Rosaria",  "Fischl",  "Barbara"], 
"Gentry of Hermitage 2021-04-28" : ["Zhongli",  "Yanfei",  "Noelle",  "Diona"], 
"Born of Ocean Swell 2021-05-18" : ["Eula",  "Xinyan",  "Xingqiu",  "Beidou"], 
"Sparkling Steps 2021-06-09" : ["Klee",  "Sucrose",  "Fischl",  "Barbara"], 
"Leaves in the Wind 2021-06-29" : ["Kaedehara Kazuha",  "Bennett",  "Razor",  "Rosaria"], 
"The Heron's Court 2021-07-21" : ["Kamisato Ayaka",  "Ningguang",  "Chongyun",  "Yanfei"], 
"Tapestry of Golden Flames 2021-08-10" : ["Yoimiya",  "Diona",  "Xinyan",  "Sayu"], 
"Reign of Serenity 2021-09-01" : ["Raiden Shogun",  "Sucrose",  "Kujou Sara",  "Xiangling"], 
"Drifting Luminescence 2021-09-21" : ["Sangonomiya Kokomi",  "Xingqiu",  "Beidou",  "Rosaria"],
};

var outfits = {
"100% Outrider" : ["Amber"],
"Ein Immernachtstraum" : ["Fischl"],
"Gunnhildr's_Legacy" : ["Jean"],
"Opulent Splendor" : ["Keqing"],
"Orchid's Evening Gown" : ["Ningguang"],
"Pact of Stars and Moon" : ["Mona"],
"Red Dead of Night" : ["Diluc"],
"Sea Breeze Dandelion" : ["Jean"],
"Summertime Sparkle" : ["Barbara"],
"To the Church's Free Spirit" : ["Rosaria"],
};

var appendData = function(field, datamap, append=false) {
	console.log("Setting " + field);
	for (var i in datamap) {
		for (var j in datamap[i]) {
			console.log(datamap[i][j]);
			var character = characters.find( c => c.name == datamap[i][j]);
			if (!character) 
				continue;
			if (!append)
				character[field] = i;
			else
				character[field].push(i);
		}
	}
};

var setOrder = function(field, order) {
	for (var i in order) {
		for (var c in characters) {
			if (characters[c][field] == order[i]) 
				characters[c][field] = String(i).padStart(3, '0')+"|"+order[i];
		}
	}
};

var display = function(text) { return text.replace(/.*\|/, ""); };

appendData("bossdrop", bossDrops);
appendData("specialty", specialities);
appendData("weekly", weeklyBossDrops);
appendData("outfits", outfits, true);
appendData("banners", banners, true);
setOrder("talentbook", ["Freedom", "Resistance", "Ballad", "Prosperity", "Diligence", "Gold", "Transience", "Elegance", "Light", "Admonition", "Ingenuity", "Praxis"]);
setOrder("element", ["Geo", "Anemo", "Cryo", "Electro", "Hydro", "Pyro", "Dendro"]);
setOrder("height", ["Small", "Medium", "Tall"]);


Character.prototype.render = function() {
	var card = $('<div class="card"></div>');
	card.addClass("rarity-" + this.rarity);
	var face = $('<div class="face"></div>');
	face.css('background-image', "url('images/thumbs/Character_"+this.name.replace(/ /g, "_")+"_Thumb.png')");
	var element = $('<div>').addClass('element').addClass(display(this.element)).css('background-image', 
	"url(images/Element_" + display(this.element) + ".png)");
	console.log(this.name + "  " + "url(images/Element_" + display(this.element) + ".png)");
	var weapon = $('<div class="weapon"></div>').addClass(display(this.weapon));
	var region = $('<div class="region"></div>').addClass(display(this.region));
	card.append(face).append(element);//.append(region);
	card.append($('<div class="name"><div>'+this.displayname+'</div></div>'));
	return card;

};

var Update = function() {
	if (!MakeGrid()) 
		Reposition();
	AutoScale();
};


var sortCards = function(comparator) {
	var cards = $(".card.invisible");
	if (MakeGrid()) return;
	cards.detach();
	$(".sortTable").remove();	
    cards.sort(comparator);  
	$("#content").append(cards);
	Reposition();
};

var Randomize = function() {
	model.grid = false;
	sortCards(function() { return (Math.round(Math.random())-0.5); });
	Update();
}

var model = {
	currentSort: "element",
	currentSortPolarity: 1,
	previousSort: "weapon",
	previousSortPolarity: 1,
	grid: true
};

var Reposition = function() {
	if (!model.grid) {
		$("#content").append($(".sortTable .card.invisible").detach());
		$(".sortTable").remove();
	}
	$(".card.real").each(function(){
		$(this).css("left", $(this).data("copy").position().left);
		$(this).css("top", $(this).data("copy").position().top);
		$(this).css("margin", $(this).data("copy").css("margin"));
	});
};

var AutoScale = function() {
	return;
	if (model.grid) {
		while(($(".sortTable").position().top + $(".sortTable").height() > $(window).scrollTop() + $(window).height()) ||
			($(".sortTable").position().left + $(".sortTable").width() > $(window).scrollLeft() + $(window).width() )) {
			if ($("#zoomSlider").val() > 1) {
				$("#zoomSlider").val(parseInt($("#zoomSlider").val()) - 1);
				console.log($("#zoomSlider").val());
				ZoomHandler();
			} else
			return;
		}
		
		while(($(".sortTable").position().top + $(".sortTable").height() < $(window).scrollTop() + $(window).height()) ||
			($(".sortTable").position().left + $(".sortTable").width() < $(window).scrollLeft() + $(window).width() )) {
			if ($("#zoomSlider").val() < 100) {
				$("#zoomSlider").val(parseInt($("#zoomSlider").val()) + 1);
				console.log($("#zoomSlider").val());
				ZoomHandler();
			} else
			return;
		}
	}
};

var ScaleCards = function(scale) {
	$(".card.invisible").css("width", (100 * scale)+"px").css("height", (125 * scale)+"px").css("margin", (10 * scale)+"px");
	var trans = ((scale - 1) * 50) + "%";
	$(".card.real").css("transform", "translateX("+trans+") translateY("+trans+") scale("+scale+") ").css("margin", (10 * scale)+"px");
	//$(".card.real").css("width", (100 * scale)+"px").css("height", (125 * scale)+"px");
	Reposition();
	$("#dynamicStyle").html(".card:hover {transform: translateX("+trans+") translateY("+trans+") scale("+1.07*scale+") !important;}");
};




var addSortCss = function(obj, sorting, item) {
	var backgroundImage = "";
	var backgroundMap = {
		'bossdrop': 'Item_',
		'weekly': 'Item_',
		'specialty': 'Item_',
		'talentbook': 'Item_Guide_to_',
		'weapon': 'Weapon_',
		'region': 'Region_',
		'element': 'Element_'
	};
	if (sorting in backgroundMap) {
		obj.css('background-image', "url('images/" + backgroundMap[sorting]+item.replace(/ /g, "_").replace(/'/g, "%27") + ".png')");
	}
	obj.addClass(sorting).addClass(+item.replace(/ /g, "_"));
	return obj;
};

var MakeGrid = function() {
	if (!model.grid) return false;
	if (model.currentSort == "" || model.previousSort == "") return false;
	var cards = $(".card.invisible").detach();
	$(".sortTable").remove();
	var cols = [];
	var rows = [];
	var table = {};
	
	cards.each(function(){
		var propRow = $(this).data("character")[model.currentSort];
		var propCol = $(this).data("character")[model.previousSort];
		if (!cols.includes(propCol)) cols.push(propCol);
		if (!rows.includes(propRow)) rows.push(propRow);
	});
	rows.sort();
	if (model.currentSortPolarity == -1) rows.reverse();
	cols.sort();
	if (model.previousSortPolarity == -1) cols.reverse();
	
	var tableElem = $("<table>").addClass("sortTable");
	$("#content").append(tableElem);
	var tbody = $("<tbody>");
	tableElem.append(tbody);
	var header = $("<tr>").append($("<th>"));
	for (var j in cols)
	{
		var col = cols[j];
		header.append(addSortCss($("<th>"+display(col)+"</th>"), model.previousSort, display(col)));
	}
	tbody.append(header);
	for (var i in rows) {
		var row = rows[i];
		var rowelem = $("<tr>").append(
		addSortCss($("<th>"+display(row)+"</th>"), model.currentSort, display(row.replace(/ /g, "_"))));
		for (var j in cols) {
			var col = cols[j];
			var cell = $("<td></td>");
			if (! (row in table)) table[row] = {};
			table[row][col] = cell;
			rowelem.append(cell);
		}
		tbody.append(rowelem);
	}
	
	cards.each(function() {
		var propRow = $(this).data("character")[model.currentSort];
		var propCol = $(this).data("character")[model.previousSort];
		table[propRow][propCol].append($(this));
	});
	
	Reposition();
	return true;
};

var ZoomHandler = function() {
		var zoom = Math.pow(2, ($("#zoomSlider").val() - 50) / 40);
		ScaleCards(zoom);
};

var ZoomSlider = function(){

	var slider = $('<input type="range" min="1" max="100" value="50" class="slider" id="zoomSlider">');
	slider.on('input', ZoomHandler);
	$("#sorts").append(slider);
};

var GridMode = function() {
	var gridButton = $("<div>grid</div>").addClass("sorter");
	gridButton.click(function(){ 
		model.grid = !model.grid;
		MakeGrid();
		Reposition();
	});
	$("#sorts").append(gridButton);
};

var CardClick = function() {
	var character = $(this).data("character")
	var cardOutfits = character.outfits;
	if (cardOutfits.length > 0) {
		var outfit = ($(this).data("outfit") + 1) % (cardOutfits.length + 1);
		$(this).data("outfit", outfit);
		var image = outfit == 0 ? "Character_"+character.name : "Outfit_"+cardOutfits[outfit - 1];
		$(this).find(".face").css('background-image', "url('images/thumbs/"+image.replace(/ /g, "_").replace(/'/g, "%27") +"_Thumb.png')")
	}
};


var Init = function() {
	for (var quality in qualities) {
		var sorter = $("<div>"+qualities[quality]+"</div>").addClass("sorter");
		sorter.data("sort", qualities[quality]);
		sorter.click(function(){		
			var prop = $(this).data("sort");
			if (prop == model.currentSort) {
				model.currentSortPolarity *= -1;
			} else {
				model.previousSort = model.currentSort;
				model.previousSortPolarity = model.currentSortPolarity;
				model.currentSort = prop;
				model.currentSortPolarity = 1;
			}
			sortCards(function(a, b) {
//			console.log($(a).data("character")[prop]);
			return model.currentSortPolarity * $(a).data("character")[prop].localeCompare($(b).data("character")[prop]); });
		});
		$("#sorts").append(sorter);
	}
	GridMode();
	ZoomSlider();
	var random = $("<div>random</div>").addClass("sorter");
	random.click(Randomize);
	$("#sorts").append(random);

	for (var i in characters) {
		var card = characters[i].render();
		var cardCopy = card.clone().addClass("invisible");
		card.data("character", characters[i]);
		card.data("outfit", 0);
		cardCopy.data("character", characters[i]);
		cardCopy.attr("id", characters[i].displayname+"Inv");
		card.addClass("real");
		card.attr("id", characters[i].displayname+"Real");
		card.data("copy", cardCopy)
		card.click(CardClick);
		$("#content").append(cardCopy);
		$("#content").append(card);
		
	}
};

$(document).ready(function(){
	Init();
	Update();
	ScaleCards(1);
	//$(window).on('resize', Reposition);
	$(window).resize(Reposition).trigger('resize');
	//$(window).on('scroll', Reposition); 

});





</script>
<style id="dynamicStyle">
.card {}

</style>
<style>
@font-face {
	font-family:"Genshin";
	font-style:normal;
	font-weight:normal;
	src:url('font/Genshin_Impact_Font.ttf') format("truetype");
}

.face {
	width: 100%;
	height: 80%;
	background-size: 100%;
	background-repeat: none;
	
}

.card .element {
	position: absolute;
	top: 2%;
	left: 2%;
    height: 100%;
    width: 27%;
    background-size: 100%;
    background-repeat: no-repeat;
}



.card {
	width: 100px;
	height: 125px;

	margin: 10px;
	position: absolute;
	display: inline-block;
	border-radius: 10px;
	overflow: hidden;
	transition: transform 0.1s, top 0.5s, left 0.5s, opacity 0.5s;
}

.card.invisible {
	position: relative;
	opacity: 0.2;
}

.card.real { 
	margin: 0;
	z-index: 1;
}

.card:hover {
	transform: scale(1.07);
	box-shadow: 0 0 0px 3px white;
	z-index: 9999;
}

.card.rarity-4  {	background: linear-gradient(0deg,#917ab1 0%,#6c6192 100%);}
.card.rarity-5  {	background: linear-gradient(0deg,#de9552 0%,#9a6d43 100%);}
.card.rarity-5a {	background: linear-gradient(0deg,#b8454a 0%,#a3464a 100%);}


.card .name {
	height: 20%;
	text-align: center;
	background-color: #E9E5DC;
	font-size: 12pt;
	color: #633;
	
	font-family: "Genshin","Helvetica Neue",Helvetica,Arial,sans-serif;
	vertical-align: middle;
	position: relative;
}

.card .name:before {
	content: "";
	position:absolute;
	height: 100%;
	width: 100%;
	top: -100%;
	left: 0%;
    border-radius: 0 0 20px 0;
    box-shadow: 20px 1px 0 0 #E9E5DC;
}

.card .name div {
	position: absolute;
	top: 50%; left: 50%;
	width: 100%;
	transform: translate(-50%,-50%);
	display: inline-block; 
}



th.weapon, th.region, th.element, th.talentbook, th.specialty, th.bossdrop, th.weekly {
	background-size: contain;
    background-repeat: no-repeat;
	height: 70px;
}


.sorter {
	position: relative;
	background-color: #de5295;
	border-radius: 5px;
	margin: 5px;
	display: inline-block;
	padding: 5px;
	cursor: pointer;
}

body {
	background-color: #000;
	color: #fff;
	font-family: Tahoma;
	user-select: none;
}

td {
	text-align: center;
}

tr:nth-child(even) {
	background-color : #111;
}

td:nth-child(even), th:nth-child(even) {
	background-color : #111;
}

tr:nth-child(even) td:nth-child(even) {
	background-color : #181818;
}

.sortTable {
	border-spacing: 0;
}

</style>
</head>
<body>
<div id="sorts"></div>
<div id="content">

</div>
</body>
</html>
